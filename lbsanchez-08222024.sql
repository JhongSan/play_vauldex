-- #1 Update the `FIRST_NAME` and `LAST_NAME` of the rows in `PROFILES` that belong to users with `ACCOUNTS` record that have "kjpmantos@vauldex.com" `EMAIL`. First name must be "Kemmy" and the last name must be "Matty".
-- #2 Retrieve the day, month and year from the `ATTEMPTED_AT` column from account histories records in a separated columns.
--   Example:
--   --------------------------
--   | Day   | Month   | Year |
--   --------------------------
--   | 01    |   08    | 2023 |
--   --------------------------
-- #3 Find the `ACCOUNTS` records of the users who have a `PROFILES` record that has a `FIRST_NAME` or `LAST_NAME` value that starts with "Eji".
-- #4 Update the `GENDER` to `:male_sign:` for profiles that have a "John" anywhere on their `FIRST_NAME` or `LAST_NAME`.
-- #5 Without using the `<`, `>` or `>=`, `<=` operators, retrieve all account records that were created from August 01, 2023 until August 15, 2023.
-- #6 Without using the `<`, `>` or `>=`, `<=` operators, count how many accounts have been created starting from August 01, 2023 to September 01, 2023.
-- #7 Using the `exists` expression, find the profile record associated with the account that has the email value "rejima@vauldex.com".
-- #8 Retrieve all the records in the accounts that belong to users who attempted successfully from their latest `ACCOUNT_AUTH_HISTORIES` record.
-- #9 Retrieve all the records in the profiles table with the gender values “:male_sign:” or “:female_sign:“. For each record, a separate column called "GENDER_IN_WORDS" should be displayed. If the gender value is `:male_sign:`, assign the value "Male". Otherwise, assign the value "Female".

CREATE TYPE "STATUS" AS ENUM ('ACTIVE', 'INACTIVE', 'DISABLED');
CREATE TYPE "GENDER" AS ENUM ('♂', '♀', '⚧');

CREATE TABLE "ACCOUNTS" (
  "ID" UUID PRIMARY KEY,
  "EMAIL" VARCHAR(255),
  "STATUS" "STATUS",
  "CREATED_AT" TIMESTAMP
);

CREATE TABLE "PROFILES" (
  "ACCOUNT_ID" UUID PRIMARY key references "ACCOUNTS"("ID") ,
  "FIRST_NAME" VARCHAR(255),
  "LAST_NAME" VARCHAR(255),
  "GENDER" "GENDER"
);

CREATE TABLE "ACCOUNT_AUTH_HISTORIES" (
  "ACCOUNT_ID" UUID references "ACCOUNTS"("ID") ,
  "IS_SUCCESS" boolean,
  "ATTEMPTED_AT" TIMESTAMP,
  primary key ("ACCOUNT_ID", "ATTEMPTED_AT")
);

INSERT INTO "ACCOUNTS" ("ID", "EMAIL", "STATUS", "CREATED_AT") VALUES ('fdec52a1-2ff9-4cec-9a49-36aa63a9f100', 'mribersabal@vauldex.com', 'ACTIVE', '2023-09-10 10:41:41.653');
INSERT INTO "ACCOUNTS" ("ID", "EMAIL", "STATUS", "CREATED_AT") VALUES ('4c7a74f1-3c60-4bbc-93db-0545c8e3d2aa', 'atcueme@vauldex.com', 'ACTIVE', '2023-09-01 00:00:00');
INSERT INTO "ACCOUNTS" ("ID", "EMAIL", "STATUS", "CREATED_AT") VALUES ('2354c479-bb21-4d50-886e-0a119e885d65', 'jkvlesmes@vauldex.com', 'INACTIVE', '2023-09-03 00:00:00');
INSERT INTO "ACCOUNTS" ("ID", "EMAIL", "STATUS", "CREATED_AT") VALUES ('254985ac-0dc7-4e7e-bcf6-870c5b67675f', 'kjpmantos@vauldex.com', 'INACTIVE', '2023-08-01 00:00:00');
INSERT INTO "ACCOUNTS" ("ID", "EMAIL", "STATUS", "CREATED_AT") VALUES ('59921e8c-6370-450d-9146-5ef6cc429638', 'kknpepito@vauldex.com', 'INACTIVE', '2023-08-15 00:00:00');
INSERT INTO "ACCOUNTS" ("ID", "EMAIL", "STATUS", "CREATED_AT") VALUES ('5eb1b2f8-31d8-49c8-97e8-377791d971f7', 'mjbquieta@vauldex.com', 'DISABLED', '2023-08-13 00:00:00');
INSERT INTO "ACCOUNTS" ("ID", "EMAIL", "STATUS", "CREATED_AT") VALUES ('3953d0c0-5663-4520-b4d6-7087259d243d', 'rejima@vauldex.com', 'DISABLED', '2023-09-08 00:00:00');
INSERT INTO "ACCOUNTS" ("ID", "EMAIL", "STATUS", "CREATED_AT") VALUES ('337984f4-50c3-49bb-813e-bafa34bedb5c', 'eblangga@vauldex.com', 'DISABLED', '2023-09-01 00:00:00');
INSERT INTO "ACCOUNTS" ("ID", "EMAIL", "STATUS", "CREATED_AT") VALUES ('bc3d9eef-ddf5-4a40-834f-d5de26c2ba58', 'lllanzarrote@vauldex.com', 'DISABLED', '2023-09-13 00:00:00');

INSERT INTO "PROFILES" ("ACCOUNT_ID", "FIRST_NAME", "LAST_NAME", "GENDER") VALUES ('fdec52a1-2ff9-4cec-9a49-36aa63a9f100', 'Mikee', 'Bersabal', '♂');
INSERT INTO "PROFILES" ("ACCOUNT_ID", "FIRST_NAME", "LAST_NAME", "GENDER") VALUES ('4c7a74f1-3c60-4bbc-93db-0545c8e3d2aa', 'Albert', 'Cueme', '♂');
INSERT INTO "PROFILES" ("ACCOUNT_ID", "FIRST_NAME", "LAST_NAME", "GENDER") VALUES ('2354c479-bb21-4d50-886e-0a119e885d65', 'John Kevin', 'Lesmes', '♂');
INSERT INTO "PROFILES" ("ACCOUNT_ID", "FIRST_NAME", "LAST_NAME", "GENDER") VALUES ('254985ac-0dc7-4e7e-bcf6-870c5b67675f', 'Kem John', 'Mantos', '♀');
INSERT INTO "PROFILES" ("ACCOUNT_ID", "FIRST_NAME", "LAST_NAME", "GENDER") VALUES ('59921e8c-6370-450d-9146-5ef6cc429638', 'Kynji Kyle', 'Pepito', '♀');
INSERT INTO "PROFILES" ("ACCOUNT_ID", "FIRST_NAME", "LAST_NAME", "GENDER") VALUES ('5eb1b2f8-31d8-49c8-97e8-377791d971f7', 'Michael John', 'Quieta', '♀');
INSERT INTO "PROFILES" ("ACCOUNT_ID", "FIRST_NAME", "LAST_NAME", "GENDER") VALUES ('3953d0c0-5663-4520-b4d6-7087259d243d', 'Ryo', 'Ejima', '⚧');
INSERT INTO "PROFILES" ("ACCOUNT_ID", "FIRST_NAME", "LAST_NAME", "GENDER") VALUES ('337984f4-50c3-49bb-813e-bafa34bedb5c', 'Edwin', 'Langga', '⚧');
INSERT INTO "PROFILES" ("ACCOUNT_ID", "FIRST_NAME", "LAST_NAME", "GENDER") VALUES ('bc3d9eef-ddf5-4a40-834f-d5de26c2ba58', 'Laarni', 'Lanzarrote', '♀');

INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('fdec52a1-2ff9-4cec-9a49-36aa63a9f100', true, '2023-09-10 10:42:00');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('fdec52a1-2ff9-4cec-9a49-36aa63a9f100', false, '2023-09-10 00:00:00');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('fdec52a1-2ff9-4cec-9a49-36aa63a9f100', false, '2023-09-11 03:22:10');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('fdec52a1-2ff9-4cec-9a49-36aa63a9f100', true, '2023-09-11 04:01:00');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('fdec52a1-2ff9-4cec-9a49-36aa63a9f100', false, '2023-09-13 06:35:44');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('fdec52a1-2ff9-4cec-9a49-36aa63a9f100', true, '2023-09-13 08:23:05');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('4c7a74f1-3c60-4bbc-93db-0545c8e3d2aa', true, '2023-09-01 00:01:22');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('4c7a74f1-3c60-4bbc-93db-0545c8e3d2aa', true, '2023-09-02 12:30:30');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('2354c479-bb21-4d50-886e-0a119e885d65', true, '2023-09-03 00:05:10');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('2354c479-bb21-4d50-886e-0a119e885d65', false, '2023-09-03 01:00:10');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('2354c479-bb21-4d50-886e-0a119e885d65', false, '2023-09-03 01:10:10');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('2354c479-bb21-4d50-886e-0a119e885d65', false, '2023-09-03 01:25:23');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('2354c479-bb21-4d50-886e-0a119e885d65', false, '2023-09-03 01:30:30');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('254985ac-0dc7-4e7e-bcf6-870c5b67675f', true, '2023-08-01 06:10:00');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('254985ac-0dc7-4e7e-bcf6-870c5b67675f', true, '2023-08-11 12:30:00');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('254985ac-0dc7-4e7e-bcf6-870c5b67675f', true, '2023-08-13 05:50:10');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('254985ac-0dc7-4e7e-bcf6-870c5b67675f', true, '2023-09-03 21:20:20');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('59921e8c-6370-450d-9146-5ef6cc429638', true, '2023-08-15 00:00:00');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('59921e8c-6370-450d-9146-5ef6cc429638', false, '2023-08-29 22:22:20');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('59921e8c-6370-450d-9146-5ef6cc429638', true, '2023-09-01 23:10:11');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('59921e8c-6370-450d-9146-5ef6cc429638', false, '2023-09-10 06:10:50');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('59921e8c-6370-450d-9146-5ef6cc429638', false, '2023-09-12 00:00:00');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('5eb1b2f8-31d8-49c8-97e8-377791d971f7', false, '2023-08-13 00:01:10');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('5eb1b2f8-31d8-49c8-97e8-377791d971f7', true, '2023-08-13 04:10:42');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('5eb1b2f8-31d8-49c8-97e8-377791d971f7', false, '2023-08-14 05:22:30');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('5eb1b2f8-31d8-49c8-97e8-377791d971f7', true, '2023-08-14 10:32:08');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('5eb1b2f8-31d8-49c8-97e8-377791d971f7', false, '2023-08-27 01:17:10');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('5eb1b2f8-31d8-49c8-97e8-377791d971f7', true, '2023-09-08 12:13:19');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('3953d0c0-5663-4520-b4d6-7087259d243d', true, '2023-09-08 01:09:10');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('337984f4-50c3-49bb-813e-bafa34bedb5c', false, '2023-09-01 00:00:00');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('337984f4-50c3-49bb-813e-bafa34bedb5c', false, '2023-09-01 00:10:10');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('337984f4-50c3-49bb-813e-bafa34bedb5c', false, '2023-09-01 00:20:30');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('bc3d9eef-ddf5-4a40-834f-d5de26c2ba58', true, '2023-09-13 00:10:10');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('bc3d9eef-ddf5-4a40-834f-d5de26c2ba58', true, '2023-09-13 00:20:20');
INSERT INTO "ACCOUNT_AUTH_HISTORIES" ("ACCOUNT_ID", "IS_SUCCESS", "ATTEMPTED_AT") VALUES ('bc3d9eef-ddf5-4a40-834f-d5de26c2ba58', true, '2023-09-13 00:30:30');

--#1
UPDATE "PROFILES" SET "FIRST_NAME" = 'Kemmy', "LAST_NAME" = 'Matty' 
WHERE (SELECT "EMAIL" FROM "ACCOUNTS" WHERE "ACCOUNTS"."ID" = "PROFILES"."ACCOUNT_ID") = 'kjpmantos@vauldex.com';
--#2
SELECT EXTRACT(DAY FROM "ATTEMPTED_AT") AS "DAY",
EXTRACT(MONTH FROM "ATTEMPTED_AT") AS "MONTH",
EXTRACT(YEAR FROM "ATTEMPTED_AT") AS "YEAR" FROM "ACCOUNT_AUTH_HISTORIES";
--#3
SELECT * FROM "ACCOUNTS" WHERE EXISTS(SELECT "FIRST_NAME", "LAST_NAME" FROM "PROFILES" 
WHERE "ACCOUNTS"."ID" = "PROFILES"."ACCOUNT_ID" AND ("FIRST_NAME" LIKE ('Eji%') OR "LAST_NAME" LIKE ('Eji%')));
--#4
UPDATE "PROFILES" SET "GENDER" = '♂' WHERE "FIRST_NAME" LIKE ('John%') OR "LAST_NAME" LIKE ('John%');
--#5
SELECT * FROM "ACCOUNTS" WHERE "CREATED_AT" BETWEEN 'August 01, 2023' AND 'August 15, 2023';
--#6
SELECT COUNT("CREATED_AT") FROM "ACCOUNTS" 
WHERE "CREATED_AT" BETWEEN 'August 01, 2023' AND 'September 01, 2023';
--#7
SELECT * FROM "PROFILES" WHERE 
EXISTS(SELECT "EMAIL" FROM "ACCOUNTS" WHERE "ACCOUNT_ID" = "ID" AND "EMAIL" = 'rejima@vauldex.com');
--#8
SELECT * FROM "ACCOUNTS" WHERE EXISTS(SELECT "IS_SUCCESS" FROM "ACCOUNT_AUTH_HISTORIES" 
WHERE "ACCOUNT_AUTH_HISTORIES"."ACCOUNT_ID" = "ACCOUNTS"."ID" AND "IS_SUCCESS" = TRUE);
--#9
SELECT *, CASE
WHEN "GENDER" = '♂' THEN 'Male'
WHEN "GENDER" = '♀' THEN 'Female' END AS "GENDER_IN_WORD"
FROM "PROFILES" WHERE "GENDER" IN ('♂', '♀');